{
  "query": "\n-- Primeiro, deletar etapas antigas/duplicadas\nDELETE FROM installation_steps \nWHERE inspection_item_id IN (\n  SELECT inspection_item_id \n  FROM installation_steps \n  GROUP BY inspection_item_id \n  HAVING COUNT(*) != 3\n);\n\n-- Criar as 3 etapas para todos os inspection_items\nINSERT INTO installation_steps (inspection_item_id, step_name, step_order, is_completed, completed_quantity)\nSELECT \n  ii.id,\n  step.name,\n  step.order_num,\n  0,\n  0\nFROM inspection_items ii\nCROSS JOIN (\n  SELECT 'Instalação' as name, 1 as order_num\n  UNION ALL SELECT 'Acabamento', 2\n  UNION ALL SELECT 'Finalizado', 3\n) step\nWHERE NOT EXISTS (\n  SELECT 1 FROM installation_steps ist \n  WHERE ist.inspection_item_id = ii.id \n  AND ist.step_name = step.name\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2RJ6pkiYcWrkG7s.7677514b54b3 --database AdJ4NUusdiWEA7xpHs45nc --execute \n-- Primeiro, deletar etapas antigas/duplicadas\nDELETE FROM installation_steps \nWHERE inspection_item_id IN (\n  SELECT inspection_item_id \n  FROM installation_steps \n  GROUP BY inspection_item_id \n  HAVING COUNT(*) != 3\n);\n\n-- Criar as 3 etapas para todos os inspection_items\nINSERT INTO installation_steps (inspection_item_id, step_name, step_order, is_completed, completed_quantity)\nSELECT \n  ii.id,\n  step.name,\n  step.order_num,\n  0,\n  0\nFROM inspection_items ii\nCROSS JOIN (\n  SELECT 'Instalação' as name, 1 as order_num\n  UNION ALL SELECT 'Acabamento', 2\n  UNION ALL SELECT 'Finalizado', 3\n) step\nWHERE NOT EXISTS (\n  SELECT 1 FROM installation_steps ist \n  WHERE ist.inspection_item_id = ii.id \n  AND ist.step_name = step.name\n);\n",
  "returncode": 1,
  "logs": [
    "ERROR 1267 (HY000) at line 12: Illegal mix of collations (utf8mb4_unicode_ci,IMPLICIT) and (utf8mb4_0900_ai_ci,IMPLICIT) for operation '='"
  ]
}